init_shadow_spells_effect = {
    add_to_global_variable_list = { name = shadow_spells target = flag:void_touch }
    add_to_global_variable_list = { name = shadow_spells target = flag:summon_void_leader }
    add_to_global_variable_list = { name = shadow_spells target = flag:voidborne }
}

cast_void_touch_effect = {
    if = {
        limit = { exists = var:void_touch_recipient }
        var:void_touch_recipient = {
            save_scope_as = this_recipient
        }
    }
    else_if = {
        limit = {
            exists = var:current_spell_name
            var:current_spell_name = flag:void_touch
            exists = var:spellbook_open
            exists = var:spell_recipient
        }
        var:spell_recipient = {
            save_scope_as = this_recipient
        }
    }

    scope:this_recipient ?= {
        add_trait = void_sickness
        if = {
            limit = {
                NOT = { this = root }
            }
            add_opinion = {
                modifier = wc_void_sickness_me
                target = root
            }
        }
    }
}

cast_summon_void_leader_effect = {
    if = {
        limit = { exists = var:summon_void_leader_recipient }
        var:summon_void_leader_recipient = {
            save_scope_as = this_recipient
        }
    }
    else_if = {
        limit = {
            exists = var:current_spell_name
            var:current_spell_name = flag:summon_void_leader
            exists = var:spellbook_open
            exists = var:spell_recipient
        }
        var:spell_recipient = {
            save_scope_as = this_recipient
        }
    }


    scope:this_recipient ?= {
        custom_tooltip = void_leader_leave_tt
        root = { save_scope_as = void_leader_caster }
        trigger_event = {
            id = wc_magic_spell_events.5000
        }
    }
}

cast_voidborne_effect = {
    if = {
        limit = { exists = var:voidborne_recipient }
        var:voidborne_recipient = {
            save_scope_as = this_recipient
        }
    }
    else_if = {
        limit = {
            exists = var:current_spell_name
            var:current_spell_name = flag:voidborne
            exists = var:spellbook_open
            exists = var:spell_recipient
        }
        var:spell_recipient = {
            save_scope_as = this_recipient
        }
    }

    scope:this_recipient ?= {
        show_as_tooltip = { add_trait = in_twisting_nether } 
        add_character_flag = is_siphoned_voidborne
        root = {
            save_scope_value_as = {
                name = voidborne_prowess
                value = scope:this_recipient.prowess
            }
            set_variable = {
                name = voidborne_prowess
                value = scope:this_recipient.prowess
            }
            set_variable = { name = voidborne_person value = scope:this_recipient }
            show_as_tooltip = { add_character_modifier = wc_voidborne_modifier }
            trigger_event = wc_magic_spell_events.5200
        }
        add_character_flag = {
            flag = wc_voidborne_cooldown
            years = 26
        }
    }
    
}