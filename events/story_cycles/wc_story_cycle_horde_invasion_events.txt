namespace = wc_horde_invasion

#########################################
#
#	Horde Invasion events - CK3 Edition
#
#########################################

#Spawns Troops for the Warchief
scripted_effect spawn_base_troops_warchief_effect = {
	spawn_horde_troops_effect = yes
	spawn_horde_troops_effect = yes
	spawn_horde_troops_effect = yes
}

scripted_effect spawn_base_troops_new_warchief_effect = {
	spawn_horde_troops_effect = yes
	spawn_horde_troops_effect = yes
}

# Setup Blackhand and the associated story
wc_horde_invasion.0001 = {
	scope = none
	hidden = yes

	trigger = {
		current_date >= 583.1.1
		dark_portal_was_opened_trigger = no
	}

	immediate = {
		add_to_global_variable_list = {
			name = wc_events_happened
			target = flag:dark_portal_was_opened
		}

		debug_log = "The Horde has appeared!"
		debug_log_date = yes

		title:e_horde.holder = {
			create_story = story_horde_invasion
			save_scope_as = story_owner
		}
	}
}

# Troops for the Horde
wc_horde_invasion.0002 = {
	type = character_event
	hidden = yes
	immediate = { spawn_orc_troops_based_on_culture_effect = yes }
}

# Troops for the Warchief
wc_horde_invasion.0003 = {
	type = character_event
	hidden = yes
	immediate = { spawn_base_troops_warchief_effect = yes }
}

# Troops for new Warchief
wc_horde_invasion.0004 = {
	type = character_event
	hidden = yes
	immediate = { spawn_base_troops_new_warchief_effect = yes }
}

##################
# Base Events
# 1000-1007
##################

# Starts the Horde Invasion
wc_horde_invasion.1000 = {
	type = character_event
	content_source = dlc_GOA
	window = fullscreen_event
	title = {
		first_valid = {
			triggered_desc = {
				trigger = { is_medivh_trigger = yes }
				desc = wc_horde_invasion.medivh.1000.title
			}
			triggered_desc = {
				trigger = {
					is_from_draenor_trigger = yes
					OR = {
						has_title = title:d_twilights_hammer_clan
						has_culture = culture:twilights_hammer
						religion = { is_in_family = rf_shadow }
					}
				}
				desc = wc_horde_invasion.pale_orcish.1000.title
			}
			triggered_desc = {
				trigger = { is_from_draenor_trigger = yes }
				desc = wc_horde_invasion.orcish.1000.title
			}
			triggered_desc = {
				trigger = {
					feel_the_magic_in_world_trigger = yes
				}
				desc = wc_horde_invasion.magic.1000.title
			}
			desc = wc_horde_invasion.generic_close.1000.title
		}
	}
	desc = {
		first_valid = {
			triggered_desc = {  # Medivh opening the Dark Portal
				trigger = { is_medivh_trigger = yes }
				desc = wc_horde_invasion.medivh.1000.desc
			}
			triggered_desc = { # People from Draenor - Warchief - Not in the Shadow Council
				trigger = {
					is_from_draenor_trigger = yes
					has_title = title:e_horde
				}
				desc = wc_horde_invasion.warchief_draenor.1000.desc
			}
			triggered_desc = { # People from Draenor - Warchief - In the Shadow Council
				trigger = {
					is_from_draenor_trigger = yes
					has_title = title:e_horde
					has_religion = religion:doombringer
				}
				desc = wc_horde_invasion.warchief_shadow_council_draenor.1000.desc
			}
			triggered_desc = { # People from Draenor - Gul'dan
				trigger = { is_guldan_trigger = yes }
				desc = wc_horde_invasion.guldan_draenor.1000.desc
			}
			triggered_desc = { # People from Draenor - Cho'gall
				trigger = {
					is_chogall_trigger = yes
					has_title = title:d_twilights_hammer_clan
					NOT = { has_religion = religion:shathgral_religion }
				}
				desc = wc_horde_invasion.chogall.1000.desc
			}
			triggered_desc = { # People from Draenor - Twilight's Hammer
				trigger = {
					is_from_draenor_trigger = yes
					OR = {
						has_culture = culture:twilights_hammer
						has_religion = religion:shathgral_religion
					}
				}
				desc = wc_horde_invasion.twilights_hammer.1000.desc
			}
			triggered_desc = { # People from Draenor - Shadow Council
				trigger = {
					is_from_draenor_trigger = yes
					OR = {
						AND = {
							is_chogall_trigger = yes
							NOT = { has_title = title:d_twilights_hammer_clan }
						}
						scope:guldan = {
							has_hook_of_type = {
								target = prev
								type = loyalty_hook
							}
						}
					}
				}
				desc = wc_horde_invasion.shadow_council.1000.desc
			}
			triggered_desc = { # People from Draenor - Orcish Shamanism
				trigger = {
					is_from_draenor_trigger = yes
					has_faith = faith:orcish_shamanism
				}
				desc = wc_horde_invasion.orcish_shamanism.1000.desc
			}
			triggered_desc = { # People from Draenor - General
				trigger = { is_from_draenor_trigger = yes }
				desc = wc_horde_invasion.draenor.1000.desc
			}
			triggered_desc = { # Creature attuned to magic feeling - Evil Magic
				trigger = {
					feel_the_magic_in_world_trigger = yes
					evil_magic_fel_disturbance_trigger = yes
				}
				desc = wc_horde_invasion.evil_magic.1000.desc
			}
			triggered_desc = { # Creature attuned to magic feeling - Good Magic
				trigger = {
					feel_the_magic_in_world_trigger = yes
					good_magic_fel_disturbance_trigger = yes
				}
				desc = wc_horde_invasion.good_magic.1000.desc
			}
			triggered_desc = { # Creature attuned to magic feeling - Elemental Magic
				trigger = {
					feel_the_magic_in_world_trigger = yes
					elemental_magic_fel_disturbance_trigger = yes
				}
				desc = wc_horde_invasion.elemental_magic.1000.desc
			}
			triggered_desc = { # Creature attuned to magic feeling - Fallback Magic
				trigger = { feel_the_magic_in_world_trigger = yes }
				desc = wc_horde_invasion.fallback_magic.1000.desc
			}
			desc = wc_horde_invasion.generic_close.1000.desc # Basic fallback
		}
	}
	theme = horde
	override_background = { # Medivh background
		trigger = { is_medivh_trigger = yes }
		reference = wc_fullscreen_opening_dark_portal
	}
	override_background = { # Twilight's Hammer background
		trigger = {
			is_from_draenor_trigger = yes
			OR = {
				has_title = title:d_twilights_hammer_clan
				has_culture = culture:twilights_hammer
				religion = { is_in_family = rf_shadow }
			}
		}
		reference = wc_fullscreen_dark_gods
	}
	override_background = { # Draenor background
		trigger = { is_from_draenor_trigger = yes }
		reference = wc_fullscreen_dark_portal
	}
	override_background = { # Magic background
		trigger = { 
			is_medivh_trigger = no
			is_from_draenor_trigger = no
			feel_the_magic_in_world_trigger = yes
		}
		reference = wc_fullscreen_fel_disturbance
	}
	override_background = { # Black Morass background
		trigger = { 
			is_medivh_trigger = no
			is_from_draenor_trigger = no
			feel_the_magic_in_world_trigger = no
		}
		reference = wc_fullscreen_black_morass
	}

	# Base
	option = {
		trigger = {
			get_news_from_region_trigger = { REGION = world_eastern_kingdoms_azeroth }
			is_medivh_trigger = no
			feel_the_magic_in_world_trigger = no
			NOT = {
				OR = {
					has_title = title:e_horde
					has_title = title:k_shadow_council
					is_vassal_or_below_of = title:e_horde.holder
				}
			}
		}
		name = {
			text = {
				first_valid = {
					triggered_desc = {
						trigger = { is_from_draenor_not_horde_trigger = yes }
						desc = wc_horde_invasion.1000.draenor_not_horde
					}
					triggered_desc = {
						trigger = { has_title = title:k_stormwind }
						desc = wc_horde_invasion.1000.stormwind_king
					}
					desc = wc_horde_invasion.1000.generic_close
				}
			}
		}
		fallback = yes
	}

	# Medivh option
	option = {
		trigger = { is_medivh_trigger = yes }
		name = wc_horde_invasion.1000.medivh
	}

	# Magic option
	option = {
		trigger = {
			is_medivh_trigger = no
			is_from_draenor_trigger = no
			feel_the_magic_in_world_trigger = yes
		}
		name = wc_horde_invasion.1000.magic

		stress_impact = {
			base = minor_stress_impact_gain
		}
	}

	# Horde option
	option = {
		trigger = {
			is_landed = yes
			NOT = { has_title = title:e_horde }
			OR = {
				has_title = title:k_shadow_council
				is_vassal_or_below_of = title:e_horde.holder
			}
		}
		name = {
			text = {
				first_valid = {
					triggered_desc = {
						trigger = { has_title = title:k_shadow_council }
						desc = wc_horde_invasion.1000.orcish_warchief_and_shadowlord
					}
					triggered_desc = {
						trigger = { has_faith = faith:orcish_shamanism }
						desc = wc_horde_invasion.1000.orcish_shamanic
					}
					desc = wc_horde_invasion.1000.orcish
				}
			}
		}
		show_as_tooltip = { spawn_orc_troops_based_on_culture_effect = yes }
	}

	# Warchief option
	option = {
		trigger = { has_title = title:e_horde }
		name = wc_horde_invasion.1000.orcish_warchief_and_shadowlord
		show_as_tooltip = { spawn_base_troops_warchief_effect = yes }
	}
}

# Ends the Horde Invasion when enough lands taken
wc_horde_invasion.1001 = {
	type = character_event
	content_source = dlc_GOA
	title = wc_horde_invasion.1001.title
	desc = wc_horde_invasion.1001.desc
	theme = horde
	override_background = { reference = wc_background_dark_portal }
	left_portrait = root

	option = { # The orcs need their warchief!
		trigger = {
			trigger_if = {
				limit = { NOT = { has_game_rule = wc_collapse_of_the_first_horde_never } } # If has this gamerule, always available
				trigger_if = {
					limit = { NOT = { has_game_rule = wc_collapse_of_the_first_horde_always } }
					prestige_level >= max_prestige_level
				}
			trigger_else = { always = no }
			}
		}
		show_as_unavailable = { NOT = { has_game_rule = wc_collapse_of_the_first_horde_always } }
		
		name = wc_horde_invasion.1001.a
		
		if = {
			limit = {
				NOR = {
					has_game_rule = wc_collapse_of_the_first_horde_can_collapse_not
					has_game_rule = wc_collapse_of_the_first_horde_never
				}
			}
			custom_tooltip = wc_members_choice_the_first_horde_tooltip
			add_tyranny = 60

			save_scope_as = warchief
			every_vassal = { add_to_temporary_list = horde_vassals }

			every_in_list = { # Ask if you want to stay
				list = horde_vassals
				trigger_event = wc_horde_invasion.1002
			}
		}
		else = {
			custom_tooltip = wc_save_the_first_horde_tooltip
			
			if = {
				limit = { NOT = { has_game_rule = wc_collapse_of_the_first_horde_never } }
				add_tyranny = 90
			}
		}
		
		stress_impact = {
			ambitious = medium_stress_impact_loss
			greedy = medium_stress_impact_loss
			arbitrary = medium_stress_impact_loss
			just = medium_stress_impact_gain
			generous = medium_stress_impact_gain
			content = medium_stress_impact_gain
		}
		
		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_greed = 1
				ai_honor = -1
			}
			modifier = {
				add = 200
				has_trait = ambitious
			}
			modifier = { # Weight up for stress.
				add = 20
				has_trait = greedy
			}
			modifier = { # Weight up for stress.
				add = 20
				has_trait = arbitrary
			}
			modifier = { # Weight up for stress.
				add = -20
				has_trait = just
			}
			modifier = { # Weight up for stress.
				add = -20
				has_trait = generous
			}
			modifier = { # Weight up for stress.
				add = -20
				has_trait = content
			}
		}
	}
	
	option = { # We'll go our own way
		trigger = { NOT = { has_game_rule = wc_collapse_of_the_first_horde_never } }
		
		name = wc_horde_invasion.1001.b
		destroy_title_free_vassals_effect = { limit_size = minor_realm_size }

		ai_chance = {
			base = 200
			ai_value_modifier = {
				ai_greed = -1
				ai_compassion = 1
			}
		}
	}
}

# Vassals of the horde get choice - stay or leave
wc_horde_invasion.1002 = {
	type = character_event
	content_source = dlc_GOA
	title = wc_horde_invasion.1002.title
	desc = wc_horde_invasion.1002.desc
	theme = horde
	override_background = { reference = wc_background_dark_portal }
	left_portrait = scope:warchief

	option = { # Stay
		trigger = {
			OR = {
				is_ai = no
				culture = { has_cultural_pillar = heritage_orcish }
			}
		}
		name = {
			text = {
				first_valid = {
					triggered_desc = { # Orcs option
						trigger = { culture = { has_cultural_pillar = heritage_orcish } }
						desc = wc_horde_invasion.1002.orcish.a
					}
					desc = wc_horde_invasion.1002.a # Others
				}
			}
		}

		add_opinion = {
			target = scope:warchief
			opinion = 30
			modifier = respect_opinion
		}
		scope:warchief = {
			add_opinion = {
				target = root
				opinion = 30
				modifier = grateful_opinion
			}
		}

		stress_impact = {
			ambitious = medium_stress_impact_gain
			content = minor_stress_impact_loss
		}

		ai_chance = {
			base = 100
			ai_value_modifier = { ai_greed = -1 }
			opinion_modifier = {
				opinion_target = scope:warchief
				multiplier = 2
			}
			modifier = {
				add = 200
				has_trait = content
			}
			modifier = { # Weight up for stress.
				add = -20
				has_trait = ambitious
			}
			modifier = {
				factor = 3
				highest_held_title_tier = tier_county
			}
		}
	}

	option = { # Leave
		name = {
			text = {
				first_valid = {
					triggered_desc = { # Orcs option
						trigger = { culture = { has_cultural_pillar = heritage_orcish } }
						desc = wc_horde_invasion.1002.orcish.b
					}
					desc = wc_horde_invasion.1002.b # Others
				}
			}
		}

		create_title_and_vassal_change = {
			type = independency
			save_scope_as = change
			add_claim_on_loss = no
		}
		becomes_independent = { change = scope:change }
		resolve_title_and_vassal_change = scope:change

		if = {
			limit = {
				OR = {
					is_ai = no
					culture = { has_cultural_pillar = heritage_orcish }
				}
			}
			scope:warchief = {
				add_opinion = {
					target = root
					modifier = treachery_opinion
					years = 30
				}
			}

			add_prestige = {
				value = medium_prestige_gain
				multiply = root.highest_held_title_tier
			}
			dynasty = {
				add_dynasty_prestige = {
					value = medium_dynasty_prestige_gain
					multiply = root.highest_held_title_tier
				}
			}
			stress_impact = {
				ambitious = minor_stress_impact_loss
				content = medium_stress_impact_gain
			}
		}
		
		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_greed = 1
				ai_boldness = 0.5
			}
			opinion_modifier = {
				opinion_target = scope:warchief
				multiplier = -2
			}
			modifier = {
				add = 200
				has_trait = ambitious
			}
			modifier = { # Weight up for stress.
				add = -20
				has_trait = content
			}
			modifier = {
				factor = 3
				highest_held_title_tier > tier_county
			}
			modifier = {
				factor = 3
				highest_held_title_tier > tier_duchy
			}
		}
	}
}

# The Horde is no more - notification
wc_horde_invasion.1003 = {
	type = character_event
	content_source = dlc_GOA
	title = wc_horde_invasion.1003.title
	desc = wc_horde_invasion.1003.desc
	theme = horde
	override_background = { reference = wc_background_dark_portal }
	left_portrait = scope:warchief

	option = { # Leave
		trigger = { culture = { has_cultural_pillar = heritage_orcish } }
		name = wc_horde_invasion.1003.a
	}
	option = {
		trigger = { NOT = { culture = { has_cultural_pillar = heritage_orcish } }}
		name = wc_horde_invasion.1003.b
	}
}

# Assault on Stormwind
wc_horde_invasion.1004 = {
	type = character_event
	content_source = dlc_GOA
	title = wc_horde_invasion.1004.title
	desc = wc_horde_invasion.1004.desc
	theme = horde

	override_background = { reference = bp1_bonfire }
	left_portrait = {
		character = root
		animation = celebrate_axe
	}

	immediate = {
		title:k_stormwind.holder = { save_scope_as = king_of_stormwind }
		title:e_horde.holder = { save_scope_as = warchief }
	}

	option = { # Lok'tar Ogar!
		name = wc_horde_invasion.1004.a
		flavor = wc_horde_invasion.1004.a.flavor
		declare_war_on_stormwind_effect = yes

		# Trigger Blackhand introduction, if the Warchief is Blackhand
		if = {
			limit = { root = scope:blackhand }
			trigger_event = wc_horde_invasion.1500
		}
		# Trigger Gul'dan
		if = {
			limit = { scope:guldan ?= { is_alive = yes } }
			scope:guldan = {
				trigger_event = {
					id = wc_horde_invasion.1501
					days = 7
				}
			}
		}

		every_player = { # At location notification
			if = {
				limit = {
					NOT = { has_title = title:e_horde }
					is_at_same_location = title:e_horde.holder
				}
				trigger_event = wc_horde_invasion.1005
			}
			else_if = {
				limit = {
					NOT = { has_title = title:e_horde }
					is_from_draenor_trigger = yes
					is_guldan_trigger = no
				}
				trigger_event = wc_horde_invasion.1006
			}
		}

		# Stormwind notification
		scope:king_of_stormwind = {
			trigger_event = wc_horde_invasion.1007
			every_vassal_or_below = {
				trigger_event = wc_horde_invasion.1007
			}
		}
	}
}

# Assault on Stormwind - At location notification
wc_horde_invasion.1005 = {
	type = character_event
	content_source = dlc_GOA
	title = {
		first_valid = {
			triggered_desc = {
				trigger = { is_from_draenor_trigger = no }
				desc = wc_horde_invasion.other.1005.title
			}
			desc = wc_horde_invasion.1005.title
		}
	}
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = { is_from_draenor_trigger = no }
				desc = wc_horde_invasion.other.1005.desc
			}
			triggered_desc = {
				trigger = { has_faith = faith:orcish_shamanism }
				desc = wc_horde_invasion.orcish_shamanism.1005.desc
			}
			desc = wc_horde_invasion.1005.desc
		}
	}
	theme = horde

	override_background = { reference = bp1_bonfire }
	left_portrait = {
		character = scope:warchief
		animation = celebrate_axe
	}
	lower_right_portrait = {
		character = root
	}

	option = {
		name = {
			text = {
				first_valid = {
					triggered_desc = {
						trigger = { is_from_draenor_trigger = no }
						desc = wc_horde_invasion.other.1005.a
					}
					triggered_desc = {
						trigger = { has_faith = faith:orcish_shamanism }
						desc = wc_horde_invasion.orcish_shamanism.1005.a
					}
					desc = wc_horde_invasion.1005.a
				}
			}
		}
		show_as_tooltip = { declare_war_on_stormwind_effect = yes }
	}
}

# Assault on Stormwind - Draenor notification
wc_horde_invasion.1006 = {
	type = character_event
	content_source = dlc_GOA
	title = wc_horde_invasion.1006.title
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = { has_faith = faith:orcish_shamanism }
				desc = wc_horde_invasion.orcish_shamanism.1006.desc
			}
			desc = wc_horde_invasion.1006.desc
		}
	}
	theme = horde

	left_portrait = {
		character = root
		animation = personality_honorable
	}

	option = {
		name = {
			text = {
				first_valid = {
					triggered_desc = {
						trigger = { has_faith = faith:orcish_shamanism }
						desc = wc_horde_invasion.orcish_shamanism.1006.a
					}
					desc = wc_horde_invasion.1006.a
				}
			}
		}
		show_as_tooltip = { declare_war_on_stormwind_effect = yes }
	}
}

# Assault on Stormwind - Stormwind notification
wc_horde_invasion.1007 = {
	type = character_event
	content_source = dlc_GOA
	title = wc_horde_invasion.1007.title
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = { has_title = title:k_stormwind }
				desc = wc_horde_invasion.king.1007.desc
			}
			desc = wc_horde_invasion.1007.desc
		}
	}
	theme = horde
	
	override_background = {
		trigger = { is_travelling = no }
		reference = throne_room_scope
	}
	override_background = {
		trigger = { is_travelling = yes }
		reference = terrain_travel
	}
	right_portrait = {
		character = root
		animation = stress
	}

	immediate = { show_as_tooltip = { declare_war_on_stormwind_effect = yes } }

	option = { # General - Praise your War God
		name = wc_horde_invasion.1007.a
		trigger = { NOT = { has_title = title:k_stormwind } }

		add_character_modifier = {
			modifier = pray_war_god_modifier
			years = 5
		}

		ai_chance = {
			base = 100
			modifier = {
				has_trait = zealous
				add = 35
			}
			modifier = {
				has_trait = brave
				add = 15
			}
		}
	}

	option = { # General - Prepare defenses
		name = wc_horde_invasion.1007.b
		trigger = { NOT = { has_title = title:k_stormwind } }

		root.capital_province = {
			add_province_modifier = {
				modifier = temporary_fort_province_modifier
				years = 5
			}
		}

		ai_chance = {
			base = 100
			modifier = {
				has_trait = brave
				add = -15
			}
			modifier = {
				has_trait = craven
				add = 15
			}
			modifier = {
				has_trait = patient
				add = 35
			}
		}
	}

	option = { # General - Try to assassinate the king
		name = wc_horde_invasion.1007.c
		trigger = {
			NOT = { has_title = title:k_stormwind }
			scope:king_of_stormwind ?= { is_alive = yes }
			can_start_scheme = {
				type = murder
				target_character = scope:king_of_stormwind
			}
			has_trait = deceitful
			has_trait = disloyal
		}

		start_scheme = {
			type = murder
			target_character = scope:king_of_stormwind
		}
		custom_tooltip = more_chance_to_success_scheme_effect_tt

		every_scheme = {
			limit = {
				scheme_type = murder
				scheme_target_character = scope:king_of_stormwind
			}
			add_scheme_modifier = {
				type = extra_success_chance_modifier
			}
		}

		ai_chance = {
			base = 100
			modifier = {
				opinion = {
					value <= -25
					target = scope:king_of_stormwind
				}
				add = 50
			}
		}
	}

	option = { # King - ATTACK
		name = wc_horde_invasion.king.1007.a
		trigger = { has_title = title:k_stormwind }

		custom_tooltip = horsemen_brotherhood_of_the_horse_effect_tt
		hidden_effect = {
			spawn_army = {
				uses_supply = no
				inheritable = yes
				name = brotherhood_of_the_horse_army
				men_at_arms = {
					type = armored_horsemen
					stacks = 6
				}
				location = capital_province
			}
		}

		ai_chance = {
			base = 100
		}
	}

	option = { # King - DEFEND
		name = wc_horde_invasion.king.1007.b
		trigger = { has_title = title:k_stormwind }

		custom_tooltip = pikemen_brotherhood_of_the_horse_effect_tt
		hidden_effect = {
			spawn_army = {
				uses_supply = no
				inheritable = yes
				name = brotherhood_of_the_horse_army
				men_at_arms = {
					type = pikemen_unit
					stacks = 8
				}
				location = capital_province
			}
		}

		ai_chance = {
			base = 20
		}
	}
}

######################
# Introduction Events
# 1500-1506
######################

# Blackhand Introduction
wc_horde_invasion.1500 = {
	type = character_event
	content_source = dlc_GOA
	title = wc_horde_invasion.1500.title
	desc = wc_horde_invasion.1500.desc
	theme = horde

	left_portrait = {
		character = root
		animation = personality_bold
	}

	option = { # We are going to destroy the world (canon)
		name = wc_horde_invasion.1500.a
		flavor = wc_horde_invasion.1500.a.flavor
		trigger = { scope:guldan ?= { is_alive = yes } }

		# Ruthless Warchief
		add_dread = minor_dread_gain

		# Full of loyalty to Gul'dan
		add_opinion = { modifier = loyal_servant target = scope:guldan }
		scope:guldan = {
			add_hook_no_toast = {
				target = root
				type = loyalty_hook
			}
		}

		# Leader of the conquests
		add_character_modifier = {
			modifier = horde_conqueror_modifier
			years = 5
		}

		ai_chance = {
			base = 200
		}
	}

	option = { # Fallback if Gul'dan is dead (not canon)
		name = wc_horde_invasion.1500.a_alternative
		flavor = wc_horde_invasion.1500.a_alternative.flavor
		trigger = {
			OR = {
				NOT = { exists = scope:guldan }
				scope:guldan = { is_alive = no }
			}
		}

		add_dread = medium_dread_gain
		add_prestige = medium_prestige_gain

		ai_chance = {
			base = 200
		}
	}

	option = { # Gul'dan has outlived his usefulness (not canon)
		name = wc_horde_invasion.1500.b
		flavor = wc_horde_invasion.1500.b.flavor

		trigger = {
			scope:guldan ?= { is_alive = yes }
			can_start_scheme = {
				type = murder
				target_character = scope:guldan
			}
		}
		start_scheme = {
			type = murder
			target_character = scope:guldan
		}
		custom_tooltip = more_chance_to_success_scheme_effect_tt

		every_scheme = {
			limit = {
				scheme_type = murder
				scheme_target_character = scope:guldan
			}
			add_scheme_modifier = {
				type = extra_success_chance_modifier
			}
		}

		if = {
			limit = { NOT = { has_trait = disloyal } }
			random = {
				chance = 10
				add_trait = disloyal
			}
		}

		ai_chance = {
			base = 0
		}
	}
}

# Gul'dan Introduction
wc_horde_invasion.1501 = {
	type = character_event
	content_source = dlc_GOA
	title = wc_horde_invasion.1501.title
	desc = wc_horde_invasion.1501.desc
	theme = horde

	left_portrait = {
		character = root
		animation = scheme
	}

	option = { # We are going to destroy the world (canon)
		name = wc_horde_invasion.1501.a
		flavor = wc_horde_invasion.1501.a.flavor
		trigger = {
			any_hooked_character = {
				count > 0
                root = {
                    has_hook_of_type = {
                        target = prev
                        type = loyalty_hook
                    }
				}
			}
		}

		# Guide of the Horde
		add_piety = minor_piety_gain

		# Has allies
		every_hooked_character = {
			limit = {
				root = {
					has_hook_of_type = {
						target = prev
						type = loyalty_hook
					}
				}
			}
			root = {
				add_opinion = {
					modifier = loyalty_opinion
					target = prev
				}
			}
		}

		if = {
			limit = { NOT = { title:e_horde.holder = { has_religion = religion:doombringer } } }
			stress_impact = { # Don't fully control the Horde anymore
				base = minor_stress_impact_gain
			}
		}

		ai_chance = {
			base = 200
		}
	}

	option = { # Fallback if no friends (not canon) :(
		name = wc_horde_invasion.1501.a_alternative
		flavor = wc_horde_invasion.1501.a_alternative.flavor
		trigger = {
			any_hooked_character = {
				count <= 0
                root = {
                    has_hook_of_type = {
                        target = prev
                        type = loyalty_hook
                    }
				}
			}
		}

		add_piety = minor_piety_gain
		stress_impact = { # Fuck I'm in trouble
			base = medium_stress_impact_gain	
		}
		if = {
			limit = { NOT = { title:e_horde.holder = { has_religion = religion:doombringer } } }
			stress_impact = { # Don't fully control the Horde anymore
				base = minor_stress_impact_gain
			}
		}

		ai_chance = {
			base = 200
		}
	}

	option = { # Blackhand will betray me (not canon)
		name = wc_horde_invasion.1501.b
		flavor = wc_horde_invasion.1501.b.flavor

		trigger = {
			scope:blackhand ?= {
				has_title = title:e_horde
				is_alive = yes
			}
			can_start_scheme = {
				type = murder
				target_character = scope:blackhand
			}
		}
		start_scheme = {
			type = murder
			target_character = scope:blackhand
		}
		custom_tooltip = more_chance_to_success_scheme_effect_tt

		every_scheme = {
			limit = {
				scheme_type = murder
				scheme_target_character = scope:blackhand
			}
			add_scheme_modifier = {
				type = extra_success_chance_modifier
			}
		}

		if = {
			limit = { NOT = { has_trait = disloyal } }
			random = {
				chance = 10
				add_trait = disloyal
			}
		}

		ai_chance = {
			base = 0
		}
	}
}

# Durotan Introduction
wc_horde_invasion.1502 = {
	type = character_event
	content_source = dlc_GOA
	title = wc_horde_invasion.1502.title
	desc = {
        desc = wc_horde_invasion.1502.desc
        first_valid = {
            triggered_desc = {
                trigger = {
                    OR = {
						NOT = { exists = scope:guldan }
						scope:guldan = { is_alive = no }
					}
                }
				desc = wc_horde_invasion.1502.desc_no_more_corruption_outro
            }
            triggered_desc = {
                trigger = {
                    OR = {
						NOT = { exists = scope:orgrim }
						scope:orgrim = { is_alive = no }
					}
                }
                desc = wc_horde_invasion.1502.desc_no_ogrim_outro
            }
            desc = wc_horde_invasion.1502.desc_normal_outro
        }
    }
	theme = frostwolf

	left_portrait = {
		character = root
		animation = anger
	}
	lower_right_portrait = {
		character = scope:guldan
	}

	option = { # Fuck you Guldan (canon)
		name = wc_horde_invasion.1502.a
		flavor = wc_horde_invasion.1502.a.flavor
		trigger = { scope:guldan ?= { is_alive = yes } }

		stress_impact = {
			base = minor_stress_impact_gain
		}

		# Start a rivalry against Gul'dan
		scope:guldan = {
			if = {
				limit = { NOT = { has_relation_rival = root } }
				set_relation_rival = {
					target = root
					reason = rival_threat_for_the_world
				}
			}
		}

		# Orgrim thinks you are unreasonable
		if = {
			limit = { scope:orgrim ?= { is_alive = yes } }
			scope:orgrim = {
				add_opinion = {
					target = root
					modifier = unreasonable_opinion
				}
			}
		}

		# TODO: Start the event who will start the Exodus of the Frostwolves here, like 6 months later

		ai_chance = {
			base = 200
		}
	}

	option = { # If Gul'dan is not here, basic option (not canon)
		name = wc_horde_invasion.1502.a_alternative
		flavor = wc_horde_invasion.1502.a_alternative.flavor
		trigger = {
			OR = {
				NOT = { exists = scope:guldan }
				scope:guldan = { is_alive = no }
			}
		}

		add_piety = medium_piety_gain
	}

	option = { # I should follow the other clans for now (not canon)
		name = wc_horde_invasion.1502.b
		flavor = wc_horde_invasion.1502.b.flavor
		trigger = { title:e_horde.holder = { has_faith = faith:orcish_fel } }

		stress_impact = {
			base = medium_stress_impact_gain
			cynical = minor_stress_impact_loss
			zealous = minor_stress_impact_gain
		}

		title:e_horde.holder = { save_scope_as = actor }
		root = { save_scope_as = recipient }
		demand_conversion_interaction_effect = yes

		ai_chance = {
			base = 0
		}
	}
}

# Orgrim Doomhammer Introduction
wc_horde_invasion.1503 = {
	type = character_event
	content_source = dlc_GOA
	title = wc_horde_invasion.1503.title
	desc = wc_horde_invasion.1503.desc
	theme = horde

	override_background = { reference = bp1_bonfire }
	left_portrait = {
		character = root
		animation = personality_honorable
	}

	option = { # Path to glory (canon)
		name = wc_horde_invasion.1503.a
		flavor = wc_horde_invasion.1503.a_flavor

		# Path to glory modifier
		add_character_modifier = {
			modifier = path_to_glory_modifier
			years = 5
		}

		# You are strong and ambitious, and you want the warchief position, the Horde like that
		title:e_horde.holder = {
			every_vassal = {
				limit = { NOT = { this = root }}
				add_opinion = {
					target = root
					modifier = path_to_glory_opinion
				}
			}
		}

		# Durotan think you're wrong
		if = {
			limit = { scope:durotan ?= { is_alive = yes } }
			scope:durotan = {
				add_opinion = {
					target = root
					modifier = unreasonable_opinion
				}
			}
		}

		ai_chance = {
			base = 200
		}
	}

	option = { # Durotan was right (not canon)
		name = wc_horde_invasion.1503.b
		flavor = wc_horde_invasion.1503.b_flavor
		trigger = { scope:guldan ?= { is_alive = yes } }

		stress_impact = {
			base = minor_stress_impact_gain
			ambitious = medium_stress_impact_gain # You miss your ambitions
		}

		scope:guldan = {
			if = {
				limit = { NOT = { has_relation_rival = root } }
				set_relation_rival = {
					target = root
					reason = rival_threat_for_the_world
				}
			}
		}

		# Durotan is happy that you saw the truth at this state
		if = {
			limit = { scope:durotan ?= { is_alive = yes } }
			scope:durotan = {
				add_opinion = {
					target = root
					modifier = trusted_judgement_opinion
				}
			}
		}

		ai_chance = {
			base = 0
		}
	}
}

# Kilrogg Introduction
wc_horde_invasion.1504 = {
	type = character_event
	content_source = dlc_GOA
	title = wc_horde_invasion.1504.title
	desc = wc_horde_invasion.1504.desc
	theme = bleeding_hollow

	left_portrait = {
		character = root
		animation = personality_bold
	}

	option = { # Explore the lands (canon)
		name = wc_horde_invasion.1504.a
		flavor = wc_horde_invasion.1504.a_flavor

		add_prestige = medium_prestige_gain
		add_trait = loyal # You are loyal to the Horde, to the Warchief and to your clan

		# TODO: Start Invasion of Stranglethorn story cycle here
		custom_tooltip = {
			text = wc_horde_invasion.1504.a_tooltip
		}

		ai_chance = {
			base = 200
		}
	}

	option = { # Path to glory (not canon)
		name = wc_horde_invasion.1504.b
		flavor = wc_horde_invasion.1504.b_flavor

		# Path to glory modifier
		add_character_modifier = {
			modifier = path_to_glory_modifier
			years = 5
		}

		if = { # Your impatience is changed into ambition
			limit = { has_trait = impatient }
			remove_trait = impatient
			add_trait = ambitious
		}
		else = {
			add_trait = disloyal
		}

		# You are strong and ambitious, and you want the warchief position, the Horde like that
		title:e_horde.holder = {
			every_vassal = {
				limit = { NOT = { this = root }}
				add_opinion = {
					target = root
					modifier = path_to_glory_opinion
				}
			}
		}

		ai_chance = {
			base = 0
		}
	}
}

# Cho'gall Introduction
wc_horde_invasion.1505 = {
	type = character_event
	content_source = dlc_GOA
	title = wc_horde_invasion.1505.title
	desc = wc_horde_invasion.1505.desc
	theme = twilights_hammer

	left_portrait = {
		character = root
		animation = disbelief
	}

	option = { # Gall will see the truth (canon)
		name = wc_horde_invasion.1505.a
		flavor = wc_horde_invasion.1505.a_flavor

		trigger_event = {
			id = wc_horde_invasion.1506
			days = 66
		}

		faith:twilights_hammer_cult = { save_temporary_scope_as = new_faith }
		custom_tooltip = convert_to_twilights_hammer_effect_tt

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_zeal = -1
			}
		}
	}

	option = { # Our masters are the demons (not canon)
		name = wc_horde_invasion.1505.b
		flavor = wc_horde_invasion.1505.b_flavor

		add_trait = loyal
		root = { set_relation_friend = { reason = friend_show_loyalty target = scope:guldan } } # Enforce your loyalty

		# TODO: Start Whispers of the Old Gods here

		ai_chance = {
			base = 0
		}
	}

	# TODO: Readd when Dark Shamanism is in game
	#option = { # Nobody can command us (no canon)
	#	name = wc_horde_invasion.1505.c
	#	flavor = wc_horde_invasion.1505.c_flavor

		# TODO: Secret conversion to Dark Shamanism
		# TODO: Start Whispers of the Old Gods here

	#	ai_chance = {
	#		base = 0
	#	}
	#}
}

# Cho'gall conversion
wc_horde_invasion.1506 = {
	type = character_event
	content_source = dlc_GOA
	title = wc_horde_invasion.1506.title
	desc = wc_horde_invasion.1506.desc
	theme = twilights_hammer

	left_portrait = {
		character = root
		animation = prayer
	}
	lower_right_portrait = {
		character = scope:devoted
	}
	artifact = {
		target = scope:newly_created_artifact
		position = lower_center_portrait
	}

	immediate = {
		faith:twilights_hammer_cult = { save_scope_as = new_faith }

		# Create the Twilight Canticle
		create_artifact_twilight_canticle_effect = { OWNER = root }

		# Secret conversion to Twilight's Hammer
		show_as_tooltip = { set_character_secret_faith = faith:twilights_hammer_cult }
		make_character_crypto_religionist_effect = { CRYPTO_RELIGION = faith:twilights_hammer_cult }

		# Create a devoted sacrificed during the event
		create_character = {
			location = root.location
			template = preacher_template
			faith = faith:orcish_fel
			culture = culture:twilights_hammer
			save_scope_as = devoted
			after_creation = { # Warcraft
				trigger_race_giving_no_gene_effect = yes
			}
		}
		scope:devoted = {
			death = {
				killer = root
				death_reason = death_viciously_dismembered
			}
		}
	}

	option = { # The Hour of Twilight come!
		name = wc_horde_invasion.1506.a
		flavor = wc_horde_invasion.1506.a_flavor

		show_as_tooltip = { create_artifact_twilight_canticle_effect = { OWNER = root } }
	}
}

# Regular Twilight's Hammer Conversion
wc_horde_invasion.1507 = {
	type = character_event
	content_source = dlc_GOA
	title = wc_horde_invasion.1507.title
	desc = wc_horde_invasion.1507.desc
	theme = twilights_hammer

	left_portrait = {
		character = root
		animation = lunatic
	}

	option = { # Glory to the Old Gods!
		name = wc_horde_invasion.1507.a
		flavor = wc_horde_invasion.1507.a_flavor

		stress_impact = {
			base = minor_stress_impact_loss
			cynical = minor_stress_impact_gain
			zealous = minor_stress_impact_loss
		}

		random = {
			chance = 15
			random_list = {
				100 = {
					random_list = {
						100 = { add_trait = depressed_genetic }
						100 = { add_trait = depressed_1 }
					}
				}
				# Schizophrenia.
				100 = {
					random_list = {
						100 = { add_trait = lunatic_genetic }
						100 = { add_trait = lunatic_1 }
					}
				}
				100 = {
					random_list = {
						100 = { add_trait = possessed_genetic }
						100 = { add_trait = possessed_1 }
					}
				}
			}
		}

		# Secret conversion to Twilight's Hammer
		show_as_tooltip = { set_character_secret_faith = faith:twilights_hammer_cult }
		make_character_crypto_religionist_effect = { CRYPTO_RELIGION = faith:twilights_hammer_cult }
	}

	option = { # Our masters are the demons now
		name = wc_horde_invasion.1507.b
		flavor = wc_horde_invasion.1507.b_flavor

		stress_impact = {
			base = minor_stress_impact_gain
			cynical = minor_stress_impact_loss
			zealous = minor_stress_impact_gain
		}
		add_trait = loyal
		add_piety = medium_piety_gain

		# TODO: Start Whispers of the Old Gods here
	}
}

#################################
# Conquests of the Horde
# 9000-9001
#################################

# Conquering of Northshire
wc_horde_invasion.9000 = {
	content_source = dlc_GOA
	title = {
		first_valid = {
			triggered_desc = {
				trigger = { is_from_the_horde_trigger = yes }
				desc = wc_horde_invasion.9000.title
			}
			desc = wc_horde_invasion.northshire.9000.title
		}
	}
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = { is_from_the_horde_trigger = yes }
				desc = wc_horde_invasion.9000.desc
			}
			desc = wc_horde_invasion.northshire.9000.desc
		}
	}
	type = character_event
	theme = horde
	
	override_background = {
		trigger = { is_from_the_horde_trigger = yes }
		reference = burning_building
	}
	override_background = {
		trigger = { is_from_the_horde_trigger = no }
		reference = temple_church
	}
	
	left_portrait = {
		character = root
		triggered_animation = {
			trigger = { is_from_the_horde_trigger = yes }
			animation = { celebrate_axe }
		}
		animation = fear
	}
	
	#Kill them all!
	option = {
		trigger = {
			root = title:b_northshire.barony_controller
			is_from_the_horde_trigger = yes
		}
		name = wc_horde_invasion.9000.a
		
		horde_bloodshed_effect = { LOCATION = scope:county }
		sack_county_effect = { LOCATION = scope:county }
		take_control_horde_effect = {
			PREVIOUS_HOLDER = title:c_northshire.holder
			NEW_TITLE = scope:county
		}
		change_culture_and_faith_horde_effect = yes
	}
	
	# Kill them all! - Notification
	option = {
		trigger = {
			NOT = { root = title:b_northshire.barony_controller }
			is_from_the_horde_trigger = yes
		}
		name = wc_horde_invasion.9000.a
		show_as_tooltip = {
			horde_bloodshed_effect = { LOCATION = scope:county }
		}
	}

	option = {
		name = wc_horde_invasion.9000.b
		custom_tooltip = wc_horde_invasion.9000.tooltip.b
		trigger = { is_from_the_horde_trigger = no }
		
		show_as_tooltip = {
			horde_bloodshed_effect = { LOCATION = scope:county }
		}
	}
}

# Sacking of Northshire - Duchy
wc_horde_invasion.9001 = {
	content_source = dlc_GOA
	title = wc_horde_invasion.9001.title
	desc = wc_horde_invasion.9001.desc
	type = character_event
	theme = horde
	
	override_background = { reference = burning_building }
	
	left_portrait = {
		character = scope:new_holder
		animation = war_over_win
	}
	
	# Sack everything and capture the remnants
	option = {
		name = wc_horde_invasion.9001.a
		custom_tooltip = wc_horde_invasion.9001.tooltip.a
		
		sack_area_effect = { TITLE = title:d_northwoods }
		change_culture_and_faith_horde_area_effect = {
			TITLE = title:d_northwoods
			CHARACTER = scope:new_holder
		}
		
		ai_chance = {
			base = 150
		}
	}
	
	# Keep this untouched
	option = {
		name = wc_horde_invasion.9001.b
		custom_tooltip = wc_horde_invasion.9001.tooltip.b
		
		add_character_modifier = {
			modifier = brought_discipline_horde_modifier
			years = 2
		}	
		minor_sack_area_effect = { TITLE = title:d_northwoods }
		
		ai_chance = {
			base = 1
		}
	}
}